{"ast":null,"code":"import _toConsumableArray from\"/home/yair/Desktop/xd/EnglishApp-main/duolingoDjango/project/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/home/yair/Desktop/xd/EnglishApp-main/duolingoDjango/project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/yair/Desktop/xd/EnglishApp-main/duolingoDjango/project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/yair/Desktop/xd/EnglishApp-main/duolingoDjango/project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import\"./styles/singlePost.css\";import send from\"../media/send.png\";import{useContext,useEffect,useState}from\"react\";import{useParams}from\"react-router-dom\";import Loader from\"./Loader\";import{helpHttp}from\"../helpers/helpHttp\";import AuthContext from\"../context/AuthContext\";import{InView}from\"react-intersection-observer\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var url=\"http://127.0.0.1:8000/api/comments/\";var parametros={method:\"GET\",headers:{accept:\"application/json\"}};var PostPage=function PostPage(){var _useContext=useContext(AuthContext),user=_useContext.user;var _useState=useState(),_useState2=_slicedToArray(_useState,2),post=_useState2[0],setPost=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),comments=_useState4[0],setComments=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),comment=_useState6[0],setComment=_useState6[1];var params=useParams();var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),fetchedComments=_useState8[0],setFetchedComments=_useState8[1];var getDate=function getDate(){var fecha=new Date();var meses=[\"en\",\"feb\",\"mar\",\"abr\",\"may\",\"jun\",\"jul\",\"agto\",\"sept\",\"oct\",\"nov\",\"dic\"];var actual=fecha.getDate()+\" \"+meses[fecha.getMonth()]+\" \"+fecha.getUTCFullYear();return actual;};var fetchAPi=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var url,response,responseJSON;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:url=\"http://127.0.0.1:8000/api/post/\".concat(params.id);_context.next=3;return fetch(url,parametros);case 3:response=_context.sent;_context.next=6;return response.json();case 6:responseJSON=_context.sent;setPost(responseJSON.post[0]);case 8:case\"end\":return _context.stop();}}},_callee);}));return function fetchAPi(){return _ref.apply(this,arguments);};}();var fetchComments=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var url,response,responseJSON;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:url=\"http://127.0.0.1:8000/api/comments/\".concat(params.id);_context2.next=3;return fetch(url,parametros);case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:responseJSON=_context2.sent;setComments(responseJSON.comments);setFetchedComments(true);//\ncase 9:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchComments(){return _ref2.apply(this,arguments);};}();var getCommentContent=function getCommentContent(e){setComment(e.target.value);// console.log(e.target.value);\n};var sendComment=function sendComment(){var options={body:{post_id:params.id,user_name:user.username,comentario:comment,date:getDate()},headers:{\"content-type\":\"application/json\"}};helpHttp().post(url,options).then(function(response){return console.log(response);});var testing={author:user.username,text:comment,created_date:getDate()};// console.log(comments);\ncomments.unshift(testing);setComments(_toConsumableArray(comments));setComment(\"\");console.log(comments);};useEffect(function(){fetchAPi();},[]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"container-post-content\",children:!post?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsxs(\"div\",{className:\"post-content\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"title-post\",children:post.title}),/*#__PURE__*/_jsx(\"div\",{className:\"box-image-post\",children:/*#__PURE__*/_jsx(\"img\",{className:\"image-single-post\",src:post.image_src})}),/*#__PURE__*/_jsx(\"div\",{className:\"box-text-post\",children:post.content}),/*#__PURE__*/_jsx(\"section\",{children:/*#__PURE__*/_jsxs(InView,{as:\"div\",onChange:function onChange(inView){inView&&!fetchedComments&&fetchComments();},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"comment-section\",children:[/*#__PURE__*/_jsx(\"input\",{autoComplete:\"off\",className:\"comment-input\",placeholder:\"Si puedes aportar algo m\\xE1s, com\\xE9ntalo!...\",name:\"comment\",id:\"comment\"// cols=\"30\"\n// rows=\"10\"\n,value:comment,onChange:getCommentContent}),/*#__PURE__*/_jsx(\"img\",{onClick:sendComment,className:comment.length>0?\"btn-send-comment\":\"btn-send-comment hidden\",src:send,alt:\"\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"all-commets\",children:comments.length>0?comments.map(function(res,id){return/*#__PURE__*/_jsxs(\"div\",{className:\"lone-comment\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"author-comment\",children:[res.author,\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"date-comment\",children:[\" \",res.created_date]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"post-comment\",children:res.text})]},id);}):/*#__PURE__*/_jsx(\"div\",{children:\"No commens\"})})]})})]})})});};export default PostPage;","map":{"version":3,"names":["send","useContext","useEffect","useState","useParams","Loader","helpHttp","AuthContext","InView","url","parametros","method","headers","accept","PostPage","user","post","setPost","comments","setComments","comment","setComment","params","fetchedComments","setFetchedComments","getDate","fecha","Date","meses","actual","getMonth","getUTCFullYear","fetchAPi","id","fetch","response","json","responseJSON","fetchComments","getCommentContent","e","target","value","sendComment","options","body","post_id","user_name","username","comentario","date","then","console","log","testing","author","text","created_date","unshift","title","image_src","content","inView","length","map","res"],"sources":["/home/yair/Desktop/xd/EnglishApp-main/duolingoDjango/project/src/components/PostPage.js"],"sourcesContent":["import \"./styles/singlePost.css\";\nimport send from \"../media/send.png\";\nimport { useContext, useEffect, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport Loader from \"./Loader\";\nimport { helpHttp } from \"../helpers/helpHttp\";\nimport AuthContext from \"../context/AuthContext\";\nimport { InView } from \"react-intersection-observer\";\nlet url = \"http://127.0.0.1:8000/api/comments/\";\nconst parametros = {\n  method: \"GET\",\n  headers: {\n    accept: \"application/json\",\n  },\n};\n\nconst PostPage = () => {\n  let { user } = useContext(AuthContext);\n\n  const [post, setPost] = useState();\n  const [comments, setComments] = useState([]);\n  const [comment, setComment] = useState(\"\");\n  const params = useParams();\n  const [fetchedComments, setFetchedComments] = useState(false);\n\n  const getDate = () => {\n    const fecha = new Date();\n    const meses = [\n      \"en\",\n      \"feb\",\n      \"mar\",\n      \"abr\",\n      \"may\",\n      \"jun\",\n      \"jul\",\n      \"agto\",\n      \"sept\",\n      \"oct\",\n      \"nov\",\n      \"dic\",\n    ];\n    let actual =\n      fecha.getDate() +\n      \" \" +\n      meses[fecha.getMonth()] +\n      \" \" +\n      fecha.getUTCFullYear();\n\n    return actual;\n  };\n\n  const fetchAPi = async () => {\n    let url = `http://127.0.0.1:8000/api/post/${params.id}`;\n    const response = await fetch(url, parametros);\n    const responseJSON = await response.json();\n    setPost(responseJSON.post[0]);\n  };\n\n  const fetchComments = async () => {\n    let url = `http://127.0.0.1:8000/api/comments/${params.id}`;\n    const response = await fetch(url, parametros);\n    const responseJSON = await response.json();\n    setComments(responseJSON.comments);\n    setFetchedComments(true); //\n  };\n\n  const getCommentContent = (e) => {\n    setComment(e.target.value);\n    // console.log(e.target.value);\n  };\n\n  const sendComment = () => {\n    let options = {\n      body: {\n        post_id: params.id,\n        user_name: user.username,\n        comentario: comment,\n        date: getDate(),\n      },\n      headers: { \"content-type\": \"application/json\" },\n    };\n    helpHttp()\n      .post(url, options)\n\n      .then((response) => console.log(response));\n\n    let testing = {\n      author: user.username,\n      text: comment,\n      created_date: getDate(),\n    };\n    // console.log(comments);\n    comments.unshift(testing);\n    setComments([...comments]);\n    setComment(\"\");\n    console.log(comments);\n  };\n\n  useEffect(() => {\n    fetchAPi();\n  }, []);\n\n  return (\n    <>\n      <div className=\"container-post-content\">\n        {!post ? (\n          <Loader></Loader>\n        ) : (\n          <div className=\"post-content\">\n            <h1 className=\"title-post\">{post.title}</h1>\n            <div className=\"box-image-post\">\n              <img className=\"image-single-post\" src={post.image_src} />\n            </div>\n\n            <div className=\"box-text-post\">{post.content}</div>\n            <section>\n              <InView\n                as=\"div\"\n                onChange={(inView) => {\n                  inView && !fetchedComments && fetchComments();\n                }}\n              >\n                <div className=\"comment-section\">\n                  <input\n                    autoComplete=\"off\"\n                    className=\"comment-input\"\n                    placeholder={`Si puedes aportar algo más, coméntalo!...`}\n                    name=\"comment\"\n                    id=\"comment\"\n                    // cols=\"30\"\n                    // rows=\"10\"\n                    value={comment}\n                    onChange={getCommentContent}\n                  ></input>\n                  <img\n                    onClick={sendComment}\n                    className={\n                      comment.length > 0\n                        ? \"btn-send-comment\"\n                        : \"btn-send-comment hidden\"\n                    }\n                    src={send}\n                    alt=\"\"\n                  />\n                </div>\n\n                <div className=\"all-commets\">\n                  {comments.length > 0 ? (\n                    comments.map((res, id) => {\n                      return (\n                        <div className=\"lone-comment\" key={id}>\n                          <div className=\"author-comment\">\n                            {res.author}{\" \"}\n                            <span className=\"date-comment\">\n                              {\" \"}\n                              {res.created_date}\n                            </span>\n                          </div>\n                          <div className=\"post-comment\">{res.text}</div>\n                        </div>\n                      );\n                    })\n                  ) : (\n                    <div>No commens</div>\n                  )}\n                </div>\n              </InView>\n            </section>\n          </div>\n        )}\n      </div>\n    </>\n  );\n};\n\nexport default PostPage;\n"],"mappings":"gmBAAA,MAAO,yBAAP,CACA,MAAOA,KAAP,KAAiB,mBAAjB,CACA,OAASC,UAAT,CAAqBC,SAArB,CAAgCC,QAAhC,KAAgD,OAAhD,CACA,OAASC,SAAT,KAA0B,kBAA1B,CACA,MAAOC,OAAP,KAAmB,UAAnB,CACA,OAASC,QAAT,KAAyB,qBAAzB,CACA,MAAOC,YAAP,KAAwB,wBAAxB,CACA,OAASC,MAAT,KAAuB,6BAAvB,C,6IACA,GAAIC,IAAG,CAAG,qCAAV,CACA,GAAMC,WAAU,CAAG,CACjBC,MAAM,CAAE,KADS,CAEjBC,OAAO,CAAE,CACPC,MAAM,CAAE,kBADD,CAFQ,CAAnB,CAOA,GAAMC,SAAQ,CAAG,QAAXA,SAAW,EAAM,CACrB,gBAAeb,UAAU,CAACM,WAAD,CAAzB,CAAMQ,IAAN,aAAMA,IAAN,CAEA,cAAwBZ,QAAQ,EAAhC,wCAAOa,IAAP,eAAaC,OAAb,eACA,eAAgCd,QAAQ,CAAC,EAAD,CAAxC,yCAAOe,QAAP,eAAiBC,WAAjB,eACA,eAA8BhB,QAAQ,CAAC,EAAD,CAAtC,yCAAOiB,OAAP,eAAgBC,UAAhB,eACA,GAAMC,OAAM,CAAGlB,SAAS,EAAxB,CACA,eAA8CD,QAAQ,CAAC,KAAD,CAAtD,yCAAOoB,eAAP,eAAwBC,kBAAxB,eAEA,GAAMC,QAAO,CAAG,QAAVA,QAAU,EAAM,CACpB,GAAMC,MAAK,CAAG,GAAIC,KAAJ,EAAd,CACA,GAAMC,MAAK,CAAG,CACZ,IADY,CAEZ,KAFY,CAGZ,KAHY,CAIZ,KAJY,CAKZ,KALY,CAMZ,KANY,CAOZ,KAPY,CAQZ,MARY,CASZ,MATY,CAUZ,KAVY,CAWZ,KAXY,CAYZ,KAZY,CAAd,CAcA,GAAIC,OAAM,CACRH,KAAK,CAACD,OAAN,GACA,GADA,CAEAG,KAAK,CAACF,KAAK,CAACI,QAAN,EAAD,CAFL,CAGA,GAHA,CAIAJ,KAAK,CAACK,cAAN,EALF,CAOA,MAAOF,OAAP,CACD,CAxBD,CA0BA,GAAMG,SAAQ,4FAAG,mKACXvB,GADW,0CAC6Ba,MAAM,CAACW,EADpC,wBAEQC,MAAK,CAACzB,GAAD,CAAMC,UAAN,CAFb,QAETyB,QAFS,qCAGYA,SAAQ,CAACC,IAAT,EAHZ,QAGTC,YAHS,eAIfpB,OAAO,CAACoB,YAAY,CAACrB,IAAb,CAAkB,CAAlB,CAAD,CAAP,CAJe,sDAAH,kBAARgB,SAAQ,0CAAd,CAOA,GAAMM,cAAa,6FAAG,wKAChB7B,GADgB,8CAC4Ba,MAAM,CAACW,EADnC,yBAEGC,MAAK,CAACzB,GAAD,CAAMC,UAAN,CAFR,QAEdyB,QAFc,uCAGOA,SAAQ,CAACC,IAAT,EAHP,QAGdC,YAHc,gBAIpBlB,WAAW,CAACkB,YAAY,CAACnB,QAAd,CAAX,CACAM,kBAAkB,CAAC,IAAD,CAAlB,CAA0B;AALN,wDAAH,kBAAbc,cAAa,2CAAnB,CAQA,GAAMC,kBAAiB,CAAG,QAApBA,kBAAoB,CAACC,CAAD,CAAO,CAC/BnB,UAAU,CAACmB,CAAC,CAACC,MAAF,CAASC,KAAV,CAAV,CACA;AACD,CAHD,CAKA,GAAMC,YAAW,CAAG,QAAdA,YAAc,EAAM,CACxB,GAAIC,QAAO,CAAG,CACZC,IAAI,CAAE,CACJC,OAAO,CAAExB,MAAM,CAACW,EADZ,CAEJc,SAAS,CAAEhC,IAAI,CAACiC,QAFZ,CAGJC,UAAU,CAAE7B,OAHR,CAIJ8B,IAAI,CAAEzB,OAAO,EAJT,CADM,CAOZb,OAAO,CAAE,CAAE,eAAgB,kBAAlB,CAPG,CAAd,CASAN,QAAQ,GACLU,IADH,CACQP,GADR,CACamC,OADb,EAGGO,IAHH,CAGQ,SAAChB,QAAD,QAAciB,QAAO,CAACC,GAAR,CAAYlB,QAAZ,CAAd,EAHR,EAKA,GAAImB,QAAO,CAAG,CACZC,MAAM,CAAExC,IAAI,CAACiC,QADD,CAEZQ,IAAI,CAAEpC,OAFM,CAGZqC,YAAY,CAAEhC,OAAO,EAHT,CAAd,CAKA;AACAP,QAAQ,CAACwC,OAAT,CAAiBJ,OAAjB,EACAnC,WAAW,oBAAKD,QAAL,EAAX,CACAG,UAAU,CAAC,EAAD,CAAV,CACA+B,OAAO,CAACC,GAAR,CAAYnC,QAAZ,EACD,CAzBD,CA2BAhB,SAAS,CAAC,UAAM,CACd8B,QAAQ,GACT,CAFQ,CAEN,EAFM,CAAT,CAIA,mBACE,sCACE,YAAK,SAAS,CAAC,wBAAf,UACG,CAAChB,IAAD,cACC,KAAC,MAAD,IADD,cAGC,aAAK,SAAS,CAAC,cAAf,wBACE,WAAI,SAAS,CAAC,YAAd,UAA4BA,IAAI,CAAC2C,KAAjC,EADF,cAEE,YAAK,SAAS,CAAC,gBAAf,uBACE,YAAK,SAAS,CAAC,mBAAf,CAAmC,GAAG,CAAE3C,IAAI,CAAC4C,SAA7C,EADF,EAFF,cAME,YAAK,SAAS,CAAC,eAAf,UAAgC5C,IAAI,CAAC6C,OAArC,EANF,cAOE,sCACE,MAAC,MAAD,EACE,EAAE,CAAC,KADL,CAEE,QAAQ,CAAE,kBAACC,MAAD,CAAY,CACpBA,MAAM,EAAI,CAACvC,eAAX,EAA8Be,aAAa,EAA3C,CACD,CAJH,wBAME,aAAK,SAAS,CAAC,iBAAf,wBACE,cACE,YAAY,CAAC,KADf,CAEE,SAAS,CAAC,eAFZ,CAGE,WAAW,kDAHb,CAIE,IAAI,CAAC,SAJP,CAKE,EAAE,CAAC,SACH;AACA;AAPF,CAQE,KAAK,CAAElB,OART,CASE,QAAQ,CAAEmB,iBATZ,EADF,cAYE,YACE,OAAO,CAAEI,WADX,CAEE,SAAS,CACPvB,OAAO,CAAC2C,MAAR,CAAiB,CAAjB,CACI,kBADJ,CAEI,yBALR,CAOE,GAAG,CAAE/D,IAPP,CAQE,GAAG,CAAC,EARN,EAZF,GANF,cA8BE,YAAK,SAAS,CAAC,aAAf,UACGkB,QAAQ,CAAC6C,MAAT,CAAkB,CAAlB,CACC7C,QAAQ,CAAC8C,GAAT,CAAa,SAACC,GAAD,CAAMhC,EAAN,CAAa,CACxB,mBACE,aAAK,SAAS,CAAC,cAAf,wBACE,aAAK,SAAS,CAAC,gBAAf,WACGgC,GAAG,CAACV,MADP,CACe,GADf,cAEE,cAAM,SAAS,CAAC,cAAhB,WACG,GADH,CAEGU,GAAG,CAACR,YAFP,GAFF,GADF,cAQE,YAAK,SAAS,CAAC,cAAf,UAA+BQ,GAAG,CAACT,IAAnC,EARF,GAAmCvB,EAAnC,CADF,CAYD,CAbD,CADD,cAgBC,mCAjBJ,EA9BF,GADF,EAPF,GAJJ,EADF,EADF,CAuED,CA7JD,CA+JA,cAAenB,SAAf"},"metadata":{},"sourceType":"module"}