{"ast":null,"code":"import _regeneratorRuntime from\"/home/yair/Desktop/what i delete form project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/yair/Desktop/what i delete form project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/yair/Desktop/what i delete form project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import jwt_decode from\"jwt-decode\";import{createContext,useEffect,useState}from\"react\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export default AuthContext;export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){return localStorage.getItem(\"authTokens\")?JSON.parse(localStorage.getItem(\"authTokens\")):null;}),_useState2=_slicedToArray(_useState,2),authTokens=_useState2[0],setAuthTokens=_useState2[1];var _useState3=useState(function(){return localStorage.getItem(\"authTokens\")?jwt_decode(localStorage.getItem(\"authTokens\")):null;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var navigate=useNavigate();var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(e.target);e.preventDefault();_context.next=4;return fetch(\"https://symptomatic-cent-production.up.railway.app/api/token/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:e.target.username.value,password:e.target.password.value})});case 4:response=_context.sent;_context.next=7;return response.json();case 7:data=_context.sent;if(response.status===200){console.log(\"success\");console.log(data);setAuthTokens(data);setUser(jwt_decode(data.access));console.log(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));navigate(\"/menu\");}else{alert(\"something went wrong\");}case 9:case\"end\":return _context.stop();}}},_callee);}));return function loginUser(_x){return _ref2.apply(this,arguments);};}();// let loginAfterSignUp =()=>{\nvar loginAfterSignUp=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dataSignUp){var response,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(\"https://symptomatic-cent-production.up.railway.app/api/token/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:dataSignUp.username,password:dataSignUp.password})});case 2:response=_context2.sent;_context2.next=5;return response.json();case 5:data=_context2.sent;if(response.status===200){console.log(\"success\");console.log(data);setAuthTokens(data);setUser(jwt_decode(data.access));console.log(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));navigate(\"/menu\");}else{alert(\"something went wrong\");}case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function loginAfterSignUp(_x2){return _ref3.apply(this,arguments);};}();// }\nvar logoutUser=function logoutUser(){setAuthTokens(null);setUser(null);localStorage.removeItem(\"authTokens\");navigate(\"/login\");};var updateToken=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var response,data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"update token called\");_context3.next=3;return fetch(\"https://symptomatic-cent-production.up.railway.app/api/token/refresh/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({refresh:authTokens===null||authTokens===void 0?void 0:authTokens.refresh})});case 3:response=_context3.sent;_context3.next=6;return response.json();case 6:data=_context3.sent;if(response.satus===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));}else{console.log(\"err\");//logoutUser();\n}if(loading){setLoading(false);}case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function updateToken(){return _ref4.apply(this,arguments);};}();var contextData={user:user,authTokens:authTokens,loginUser:loginUser,logoutUser:logoutUser,loginAfterSignUp:loginAfterSignUp};useEffect(function(){if(loading){updateToken();}var fourMinutes=1000*60*4;var interval=setInterval(function(){if(authTokens){updateToken();}},fourMinutes);return function(){return clearInterval(interval);};},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:loading?null:children});};","map":{"version":3,"names":["jwt_decode","createContext","useEffect","useState","useNavigate","AuthContext","AuthProvider","children","localStorage","getItem","JSON","parse","authTokens","setAuthTokens","user","setUser","loading","setLoading","navigate","loginUser","e","console","log","target","preventDefault","fetch","method","headers","body","stringify","username","value","password","response","json","data","status","access","setItem","alert","loginAfterSignUp","dataSignUp","logoutUser","removeItem","updateToken","refresh","satus","contextData","fourMinutes","interval","setInterval","clearInterval"],"sources":["/home/yair/Desktop/what i delete form project/src/context/AuthContext.js"],"sourcesContent":["import jwt_decode from \"jwt-decode\";\nimport { createContext, useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\n\nconst AuthContext = createContext();\n\nexport default AuthContext;\n\nexport const AuthProvider = ({ children }) => {\n  let [authTokens, setAuthTokens] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? JSON.parse(localStorage.getItem(\"authTokens\"))\n      : null\n  );\n  let [user, setUser] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? jwt_decode(localStorage.getItem(\"authTokens\"))\n      : null\n  );\n  const [loading, setLoading] = useState(true);\n\n  const navigate = useNavigate();\n\n  let loginUser = async (e) => {\n    console.log(e.target);\n    e.preventDefault();\n    let response = await fetch(\n      \"https://symptomatic-cent-production.up.railway.app/api/token/\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          username: e.target.username.value,\n          password: e.target.password.value,\n        }),\n      }\n    );\n    let data = await response.json();\n    if (response.status === 200) {\n      console.log(\"success\");\n      console.log(data);\n      setAuthTokens(data);\n\n      setUser(jwt_decode(data.access));\n      console.log(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n      navigate(\"/menu\");\n    } else {\n      alert(\"something went wrong\");\n    }\n  };\n  // let loginAfterSignUp =()=>{\n\n  let loginAfterSignUp = async (dataSignUp) => {\n    let response = await fetch(\n      \"https://symptomatic-cent-production.up.railway.app/api/token/\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          username: dataSignUp.username,\n          password: dataSignUp.password,\n        }),\n      }\n    );\n    let data = await response.json();\n\n    if (response.status === 200) {\n      console.log(\"success\");\n      console.log(data);\n      setAuthTokens(data);\n\n      setUser(jwt_decode(data.access));\n      console.log(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n      navigate(\"/menu\");\n    } else {\n      alert(\"something went wrong\");\n    }\n  };\n  // }\n\n  let logoutUser = () => {\n    setAuthTokens(null);\n    setUser(null);\n    localStorage.removeItem(\"authTokens\");\n    navigate(\"/login\");\n  };\n\n  let updateToken = async () => {\n    console.log(\"update token called\");\n    let response = await fetch(\n      \"https://symptomatic-cent-production.up.railway.app/api/token/refresh/\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          refresh: authTokens?.refresh,\n        }),\n      }\n    );\n    let data = await response.json();\n\n    if (response.satus === 200) {\n      setAuthTokens(data);\n      setUser(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n    } else {\n      console.log(\"err\");\n      //logoutUser();\n    }\n    if (loading) {\n      setLoading(false);\n    }\n  };\n\n  let contextData = {\n    user: user,\n    authTokens: authTokens,\n    loginUser: loginUser,\n    logoutUser: logoutUser,\n    loginAfterSignUp,\n  };\n\n  useEffect(() => {\n    if (loading) {\n      updateToken();\n    }\n    let fourMinutes = 1000 * 60 * 4;\n    let interval = setInterval(() => {\n      if (authTokens) {\n        updateToken();\n      }\n    }, fourMinutes);\n    return () => clearInterval(interval);\n  }, [authTokens, loading]);\n\n  return (\n    <AuthContext.Provider value={contextData}>\n      {loading ? null : children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}